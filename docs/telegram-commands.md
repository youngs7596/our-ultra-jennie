# ğŸ“± Telegram ìˆ˜ë™ ëª…ë ¹ì–´ ê°€ì´ë“œ

> **Version**: v1.0  
> **Last Updated**: 2024-12-09  
> **Status**: Planning

ì´ ë¬¸ì„œëŠ” Telegramì„ í†µí•´ íŠ¸ë ˆì´ë”© ë´‡ì— ìˆ˜ë™ ëª…ë ¹ì„ ë‚´ë¦¬ëŠ” ê¸°ëŠ¥ì— ëŒ€í•œ ì„¤ê³„ ë¬¸ì„œì…ë‹ˆë‹¤.

---

## ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ëª…ë ¹ì–´ ëª©ë¡](#ëª…ë ¹ì–´-ëª©ë¡)
3. [êµ¬í˜„ ìš°ì„ ìˆœìœ„](#êµ¬í˜„-ìš°ì„ ìˆœìœ„)
4. [ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜](#ì‹œìŠ¤í…œ-ì•„í‚¤í…ì²˜)
5. [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)

---

## ê°œìš”

### ëª©ì 
- ìš´ì˜ìê°€ Telegram ë©”ì‹œì§€ë¡œ íŠ¸ë ˆì´ë”© ë´‡ì„ ì‹¤ì‹œê°„ ì œì–´
- ê¸´ê¸‰ ìƒí™© ëŒ€ì‘ (ë§¤ìˆ˜ ì¤‘ì§€, ì „ì²´ ì²­ì‚° ë“±)
- ìˆ˜ë™ ë§¤ë§¤ ì‹¤í–‰ ë° ìƒíƒœ ì¡°íšŒ

### ê¸°ë³¸ ì›ì¹™
- ëª¨ë“  ëª…ë ¹ì€ `/` ìŠ¬ë˜ì‹œë¡œ ì‹œì‘
- ì¢…ëª© ê²€ìƒ‰ì€ ì¢…ëª©ëª… ë˜ëŠ” ì¢…ëª©ì½”ë“œ ëª¨ë‘ ì§€ì›
- ìœ„í—˜í•œ ëª…ë ¹ì€ í™•ì¸ ì ˆì°¨ í•„ìš” (ì˜ˆ: `/sellall í™•ì¸`)

---

## ëª…ë ¹ì–´ ëª©ë¡

### 1ï¸âƒ£ ë§¤ë§¤ ì œì–´ (Trading Control)

| ëª…ë ¹ | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ | ì‘ë‹µ ì˜ˆì‹œ |
|------|------|----------|----------|
| `/pause` | ì˜¤ëŠ˜ ë§¤ìˆ˜ ì¤‘ì§€ | `/pause` ë˜ëŠ” `/pause ë³€ë™ì„± í¬ë‹¤` | âœ… ë§¤ìˆ˜ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. `/resume`ìœ¼ë¡œ ì¬ê°œí•˜ì„¸ìš”. |
| `/resume` | ë§¤ìˆ˜ ì¬ê°œ | `/resume` | âœ… ë§¤ìˆ˜ê°€ ì¬ê°œë˜ì—ˆìŠµë‹ˆë‹¤. |
| `/stop` | ê¸´ê¸‰ ì „ì²´ ì¤‘ì§€ (ë§¤ìˆ˜/ë§¤ë„ ëª¨ë‘) | `/stop` | âš ï¸ ê¸´ê¸‰ ì¤‘ì§€! ëª¨ë“  ê±°ë˜ê°€ ì¤‘ë‹¨ë©ë‹ˆë‹¤. |
| `/dryrun` | DRY_RUN ëª¨ë“œ ì „í™˜ | `/dryrun on` ë˜ëŠ” `/dryrun off` | âœ… DRY_RUN ëª¨ë“œ: ON |

---

### 2ï¸âƒ£ ìˆ˜ë™ ë§¤ë§¤ (Manual Trading)

| ëª…ë ¹ | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ | ì‘ë‹µ ì˜ˆì‹œ |
|------|------|----------|----------|
| `/buy ì¢…ëª© [ìˆ˜ëŸ‰]` | ì¦‰ì‹œ ë§¤ìˆ˜ | `/buy ì‚¼ì„±ì „ì 10` | ğŸ’° ì‚¼ì„±ì „ì 10ì£¼ ë§¤ìˆ˜ ì£¼ë¬¸ ì™„ë£Œ (72,000ì›) |
| | | `/buy 005930 5` | |
| | | `/buy ì¹´ì¹´ì˜¤` (ìˆ˜ëŸ‰ ë¯¸ì§€ì • ì‹œ ìë™ ê³„ì‚°) | |
| `/sell ì¢…ëª© [ìˆ˜ëŸ‰]` | ì¦‰ì‹œ ë§¤ë„ | `/sell ì‚¼ì„±ì „ì 10` | ğŸ’µ ì‚¼ì„±ì „ì 10ì£¼ ë§¤ë„ ì™„ë£Œ (+3.5%) |
| | | `/sell 005930 ì „ëŸ‰` | |
| `/sellall` | ì „ì²´ í¬ì§€ì…˜ ì²­ì‚° (í™•ì¸ í•„ìš”) | `/sellall í™•ì¸` | âš ï¸ 3ê°œ ì¢…ëª© ì „ì²´ ì²­ì‚° ì™„ë£Œ |

> âš ï¸ **ì£¼ì˜**: ìˆ˜ëŸ‰ ë¯¸ì§€ì • ì‹œ í¬ì§€ì…˜ ì‚¬ì´ì§• ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ìë™ ê³„ì‚°

---

### 3ï¸âƒ£ ì¡°íšŒ (Status & Info)

| ëª…ë ¹ | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ | ì‘ë‹µ ì˜ˆì‹œ |
|------|------|----------|----------|
| `/status` | ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸ | `/status` | ğŸŸ¢ ì‹œìŠ¤í…œ ì •ìƒ ìš´ì˜ ì¤‘ |
| `/portfolio` | í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ | `/portfolio` | (ì•„ë˜ ì˜ˆì‹œ ì°¸ì¡°) |
| `/pnl` | ì˜¤ëŠ˜ ì†ìµ í˜„í™© | `/pnl` | ğŸ“Š ì˜¤ëŠ˜ ìˆ˜ìµ: +125,000ì› (+1.2%) |
| `/balance` | ê³„ì¢Œ ì”ê³  | `/balance` | ğŸ’° ê°€ìš© í˜„ê¸ˆ: 5,230,000ì› |
| `/price ì¢…ëª©` | í˜„ì¬ê°€ ì¡°íšŒ | `/price ì‚¼ì„±ì „ì` | ì‚¼ì„±ì „ì(005930): 72,300ì› (+1.2%) |

**`/portfolio` ì‘ë‹µ ì˜ˆì‹œ:**
```
ğŸ“Š í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ (3ì¢…ëª©)

1. ì‚¼ì„±ì „ì (005930)
   ë³´ìœ : 50ì£¼ | í‰ë‹¨: 71,000ì›
   í˜„ì¬: 72,300ì› | ìˆ˜ìµ: +1.83%

2. SKí•˜ì´ë‹‰ìŠ¤ (000660)
   ë³´ìœ : 30ì£¼ | í‰ë‹¨: 180,000ì›
   í˜„ì¬: 185,000ì› | ìˆ˜ìµ: +2.78%

3. ì¹´ì¹´ì˜¤ (035720)
   ë³´ìœ : 20ì£¼ | í‰ë‹¨: 52,000ì›
   í˜„ì¬: 51,200ì› | ìˆ˜ìµ: -1.54%

ğŸ’° ì´ í‰ê°€ê¸ˆì•¡: 15,230,000ì›
ğŸ“ˆ ì´ ìˆ˜ìµë¥ : +2.1%
```

---

### 4ï¸âƒ£ ì„¤ì • ë³€ê²½ (Settings)

| ëª…ë ¹ | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ | ì‘ë‹µ ì˜ˆì‹œ |
|------|------|----------|----------|
| `/risk ë ˆë²¨` | ë¦¬ìŠ¤í¬ ë ˆë²¨ ë³€ê²½ | `/risk conservative` | âœ… ë¦¬ìŠ¤í¬ ë ˆë²¨: CONSERVATIVE |
| | | `/risk moderate` | |
| | | `/risk aggressive` | |
| `/minscore ì ìˆ˜` | ìµœì†Œ LLM ì ìˆ˜ ë³€ê²½ | `/minscore 80` | âœ… ìµœì†Œ LLM ì ìˆ˜: 80ì  |
| `/maxbuy íšŸìˆ˜` | ì¼ì¼ ìµœëŒ€ ë§¤ìˆ˜ íšŸìˆ˜ | `/maxbuy 3` | âœ… ì¼ì¼ ìµœëŒ€ ë§¤ìˆ˜: 3íšŒ |
| `/config` | í˜„ì¬ ì„¤ì • ì¡°íšŒ | `/config` | (í˜„ì¬ ì„¤ì •ê°’ ëª©ë¡ ì¶œë ¥) |

---

### 5ï¸âƒ£ ì•Œë¦¼ ì œì–´ (Notifications)

| ëª…ë ¹ | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ | ì‘ë‹µ ì˜ˆì‹œ |
|------|------|----------|----------|
| `/mute ì‹œê°„` | Në¶„ê°„ ì•Œë¦¼ ë„ê¸° | `/mute 30` | ğŸ”‡ 30ë¶„ê°„ ì•Œë¦¼ì´ êº¼ì§‘ë‹ˆë‹¤. |
| `/unmute` | ì•Œë¦¼ ë‹¤ì‹œ ì¼œê¸° | `/unmute` | ğŸ”” ì•Œë¦¼ì´ ë‹¤ì‹œ ì¼œì¡ŒìŠµë‹ˆë‹¤. |
| `/alert ì¢…ëª© ê°€ê²©` | ê°€ê²© ì•Œë¦¼ ì„¤ì • | `/alert ì‚¼ì„±ì „ì 80000` | â° ì‚¼ì„±ì „ì 80,000ì› ë„ë‹¬ ì‹œ ì•Œë¦¼ |
| `/alerts` | ì„¤ì •ëœ ì•Œë¦¼ ëª©ë¡ | `/alerts` | (ì•Œë¦¼ ëª©ë¡ ì¶œë ¥) |

---

### 6ï¸âƒ£ ê´€ì‹¬ì¢…ëª© (Watchlist)

| ëª…ë ¹ | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ | ì‘ë‹µ ì˜ˆì‹œ |
|------|------|----------|----------|
| `/watch ì¢…ëª©` | ê´€ì‹¬ì¢…ëª© ì¶”ê°€ | `/watch ì‚¼ì„±ì „ì` | âœ… ê´€ì‹¬ì¢…ëª©ì— ì¶”ê°€: ì‚¼ì„±ì „ì |
| `/unwatch ì¢…ëª©` | ê´€ì‹¬ì¢…ëª© ì œê±° | `/unwatch 005930` | âœ… ê´€ì‹¬ì¢…ëª©ì—ì„œ ì œê±°: ì‚¼ì„±ì „ì |
| `/watchlist` | ê´€ì‹¬ì¢…ëª© ëª©ë¡ | `/watchlist` | (ê´€ì‹¬ì¢…ëª© ëª©ë¡ ì¶œë ¥) |

---

### 7ï¸âƒ£ ë„ì›€ë§ (Help)

| ëª…ë ¹ | ì„¤ëª… | ì‚¬ìš© ì˜ˆì‹œ |
|------|------|----------|
| `/help` | ëª…ë ¹ì–´ ë„ì›€ë§ | `/help` |
| `/help ëª…ë ¹ì–´` | íŠ¹ì • ëª…ë ¹ì–´ ìƒì„¸ | `/help buy` |

---

## êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1 (MVP) ğŸ¯
> í•µì‹¬ ìš´ì˜ ê¸°ëŠ¥

| ìš°ì„ ìˆœìœ„ | ëª…ë ¹ì–´ | ë‚œì´ë„ | í•„ìš” ì—°ë™ |
|---------|--------|--------|----------|
| 1 | `/pause`, `/resume` | ğŸŸ¢ ì‰¬ì›€ | Redis flag |
| 2 | `/status` | ğŸŸ¢ ì‰¬ì›€ | ê° ì„œë¹„ìŠ¤ health check |
| 3 | `/portfolio` | ğŸŸ¢ ì‰¬ì›€ | DB ì¡°íšŒ |
| 4 | `/balance` | ğŸŸ¢ ì‰¬ì›€ | KIS API |
| 5 | `/buy` | ğŸŸ¡ ë³´í†µ | buy-executor RabbitMQ |
| 6 | `/sell` | ğŸŸ¡ ë³´í†µ | sell-executor / DB |

### Phase 2 (í™•ì¥)
> í¸ì˜ ê¸°ëŠ¥

- `/pnl`, `/price`
- `/dryrun`, `/config`
- `/minscore`, `/maxbuy`

### Phase 3 (ê³ ê¸‰)
> ì•Œë¦¼ ë° ê´€ì‹¬ì¢…ëª©

- `/alert`, `/alerts`
- `/watch`, `/unwatch`
- `/mute`, `/unmute`

---

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì „ì²´ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Telegram                                â”‚
â”‚  User: "/buy ì‚¼ì„±ì „ì 10"                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  command-handler ì„œë¹„ìŠ¤                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Telegram Listener (polling ë°©ì‹)                         â”‚ â”‚
â”‚  â”‚  - getUpdates() ì£¼ê¸°ì  í˜¸ì¶œ                               â”‚ â”‚
â”‚  â”‚  - ìƒˆ ë©”ì‹œì§€ ìˆ˜ì‹  ë° íŒŒì‹±                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                  â”‚
â”‚                            â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Command Parser                                           â”‚ â”‚
â”‚  â”‚  - ëª…ë ¹ì–´ íŒŒì‹± ("/buy ì‚¼ì„±ì „ì 10")                        â”‚ â”‚
â”‚  â”‚  - ì¢…ëª© ì½”ë“œ ë³€í™˜ (ì‚¼ì„±ì „ì â†’ 005930)                      â”‚ â”‚
â”‚  â”‚  - íŒŒë¼ë¯¸í„° ì¶”ì¶œ                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                            â”‚                                  â”‚
â”‚                            â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Command Dispatcher                                       â”‚ â”‚
â”‚  â”‚  - Redis: /pause, /resume, /dryrun (flag ì €ì¥)           â”‚ â”‚
â”‚  â”‚  - RabbitMQ: /buy â†’ buy-signals í                       â”‚ â”‚
â”‚  â”‚  - Direct: /portfolio, /status (ì¦‰ì‹œ ì‘ë‹µ)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                        â”‚                    â”‚
           â–¼                        â–¼                    â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Redis  â”‚            â”‚ RabbitMQ   â”‚        â”‚ DB Query â”‚
      â”‚ Flags  â”‚            â”‚ buy-signalsâ”‚        â”‚ Results  â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                        â”‚
           â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ buy-scanner         â”‚    â”‚ buy-executor        â”‚
â”‚ - PAUSE flag í™•ì¸   â”‚    â”‚ - ë©”ì‹œì§€ ìˆ˜ì‹        â”‚
â”‚ - flag ONì´ë©´ skip  â”‚    â”‚ - ë§¤ìˆ˜ ì‹¤í–‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Redis Flag êµ¬ì¡°

```python
# í‚¤ ë„¤ì´ë° ì»¨ë²¤ì…˜
trading:pause           = "true" / "false"
trading:dryrun          = "true" / "false"
trading:stop            = "true" / "false"
config:min_llm_score    = "80"
config:max_buy_per_day  = "3"
notification:mute       = "1702012800"  # Unix timestamp (í•´ì œ ì‹œê°„)
```

---

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì¸ì¦ (Authentication)
- **Chat ID ê²€ì¦**: í—ˆìš©ëœ Chat IDë§Œ ëª…ë ¹ ì²˜ë¦¬
- í™˜ê²½ë³€ìˆ˜ `TELEGRAM_ALLOWED_CHAT_IDS`ë¡œ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬

```python
ALLOWED_CHAT_IDS = os.getenv("TELEGRAM_ALLOWED_CHAT_IDS", "").split(",")

def is_authorized(chat_id):
    return str(chat_id) in ALLOWED_CHAT_IDS
```

### 2. ìœ„í—˜ ëª…ë ¹ ë³´í˜¸
- `/sellall`, `/stop` ë“± ìœ„í—˜ ëª…ë ¹ì€ í™•ì¸ í‚¤ì›Œë“œ í•„ìš”
- ì˜ˆ: `/sellall í™•ì¸`, `/stop ê¸´ê¸‰`

### 3. Rate Limiting
- ë™ì¼ ëª…ë ¹ ë°˜ë³µ ì‹¤í–‰ ë°©ì§€ (ìµœì†Œ ê°„ê²© 5ì´ˆ)
- ì¼ì¼ ìˆ˜ë™ ê±°ë˜ íšŸìˆ˜ ì œí•œ

### 4. ë¡œê¹…
- ëª¨ë“  ëª…ë ¹ ë¡œê·¸ ê¸°ë¡ (who, when, what)
- ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í™œë™ ì•Œë¦¼

---

## êµ¬í˜„ ì°¸ê³ ì‚¬í•­

### Telegram Bot API ì—°ë™

```python
import requests

class TelegramListener:
    def __init__(self, token, allowed_chat_ids):
        self.token = token
        self.base_url = f"https://api.telegram.org/bot{token}"
        self.allowed_chat_ids = allowed_chat_ids
        self.last_update_id = 0
    
    def get_updates(self):
        """ìƒˆ ë©”ì‹œì§€ í´ë§"""
        url = f"{self.base_url}/getUpdates"
        params = {
            "offset": self.last_update_id + 1,
            "timeout": 30  # Long polling
        }
        response = requests.get(url, params=params)
        return response.json().get("result", [])
    
    def send_message(self, chat_id, text):
        """ë©”ì‹œì§€ ì „ì†¡"""
        url = f"{self.base_url}/sendMessage"
        data = {
            "chat_id": chat_id,
            "text": text,
            "parse_mode": "Markdown"
        }
        requests.post(url, data=data)
```

### ì¢…ëª© ì½”ë“œ ë³€í™˜

```python
def resolve_stock_code(name_or_code: str) -> tuple:
    """
    ì¢…ëª©ëª… ë˜ëŠ” ì½”ë“œë¥¼ ë°›ì•„ (code, name) íŠœí”Œ ë°˜í™˜
    
    Args:
        name_or_code: "ì‚¼ì„±ì „ì" ë˜ëŠ” "005930"
    
    Returns:
        ("005930", "ì‚¼ì„±ì „ì")
    """
    # 6ìë¦¬ ìˆ«ìë©´ ì½”ë“œë¡œ ê°„ì£¼
    if name_or_code.isdigit() and len(name_or_code) == 6:
        # DBì—ì„œ ì¢…ëª©ëª… ì¡°íšŒ
        stock_name = database.get_stock_name(name_or_code)
        return (name_or_code, stock_name)
    else:
        # DBì—ì„œ ì¢…ëª©ì½”ë“œ ì¡°íšŒ
        stock_code = database.get_stock_code_by_name(name_or_code)
        return (stock_code, name_or_code)
```

---

## ë‹¤ìŒ ë‹¨ê³„

1. [ ] command-handler ì„œë¹„ìŠ¤ì— Telegram Listener ì¶”ê°€
2. [ ] Redis flag ì—°ë™ (`/pause`, `/resume`)
3. [ ] docker-compose.ymlì— command-handler ì„œë¹„ìŠ¤ ë“±ë¡
4. [ ] Phase 1 ëª…ë ¹ì–´ êµ¬í˜„ ë° í…ŒìŠ¤íŠ¸
5. [ ] ë³´ì•ˆ ì„¤ì • (Chat ID í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸)
